//*****************************************************************************
// Do not remove this notice.
//
// Copyright 2001 by Mike Hall.
// See http://www.brainjar.com for terms of use.
//
// Bug fixes, timing & performance tweaks by Michael Lee, iskitzdev@yahoo.com.
//*****************************************************************************
var literalStrings,theForm;function combineLiteralStrings(s){s=s.replace(/"\+"/g,'');updateStats(s);s=s.replace(/'\+'/g,'');return updateStats(s)}function compressWhiteSpace(s){s=s.replace(/\s+(__\d+__)/g,"$1");updateStats(s);s=s.replace(/\s+/g,' ');updateStats(s);s=s.replace(/^\s(.*)/,"$1");updateStats(s);s=s.replace(/(.*)\s$/,"$1");updateStats(s);s=s.replace(/\s([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])/g,"$1");updateStats(s);s=s.replace(/([\x21\x25\x26\x28\x29\x2a\x2b\x2c\x2d\x2f\x3a\x3b\x3c\x3d\x3e\x3f\x5b\x5d\x5c\x7b\x7c\x7d\x7e])\s/g,"$1");return updateStats(s)}function crunch(f){if(this!=window)f=this;if(!f||typeof f.elements=="undefined")return"";var a=f.codeIn.value,isRealtime=f.realtime.checked;f.reset();f.codeIn.value=a;f.codeIn.onchange();f.realtime.checked=isRealtime;f.statusMsg.value="Working...";var b=(new Date()).getTime();f.statusMsg.value="Replacing literal strings...";a=replaceLiteralStrings(a);f.statusMsg.value="Removing comments...";a=removeComments(a);f.statusMsg.value="Combining literal strings...";a=combineLiteralStrings(a);f.statusMsg.value="Compressing white space...";a=compressWhiteSpace(a);f.statusMsg.value="Removing unnecessary semi-colons...";a=replaceSemiColons(a);f.statusMsg.value="Restoring literal strings...";a=restoreLiteralStrings(a);var c=(new Date()).getTime();var d=(c-b)/1000;f.statusMsg.value="Crunched in ["+d+"] seconds.";return updateStats(a,true)}window.onload=function initialize(){if(document.forms.length<1)return;theForm=document.forms[0];theForm.btnSelect.onclick=function(){theForm.codeOut.select();theForm.codeOut.focus()};theForm.codeIn.onchange=function(){theForm.sizeIn.value=Math.floor(theForm.codeIn.value.length/1024)+" KB"};theForm.onreset=function(){theForm.codeIn.focus();return true};theForm.onsubmit=function(){crunch(this);return false};theForm.reset()};function removeComments(s){s=s.replace(/\/\/.*/g,'');updateStats(s);s=s.replace(/(.*)\r\n(.*)/g,"$1__%0a__$2");updateStats(s);s=s.replace(/(.*)\n(.*)/g,"$1__%0d__$2");updateStats(s);var a=s.split("*/");for(var i=0,_i=a.length;i<_i;++i)a[i]=a[i].replace(/(.*)\/\x2a(.*)$/g,"$1 ");s=a.join('');updateStats(s);s=s.replace(/__%0a__/g,'\r\n');updateStats(s);s=s.replace(/__%0d__/g,'\n');return updateStats(s)}function replaceLiteralStrings(s){var c,t="",lines,escaped,quoteChar,inQuote,literal;literalStrings=[];lines=s.split('\n');for(var i=0,_i=lines.length;i<_i;++i,t+='\n'){inQuote=false;for(var j=0,_j=lines[i].length;j<=_j;++j){c=lines[i].charAt(j);if(!inQuote){if(c=='"'||c=="'"){inQuote=true;escaped=false;quoteChar=literal=c}else t+=c;continue}if(c==quoteChar&&!escaped){inQuote=false;literal+=quoteChar;t+="__"+literalStrings.length+"__";literalStrings[literalStrings.length]=literal;updateStats(t)}else escaped=(c=="\\"&&!escaped);literal+=c}}return updateStats(t)}function restoreLiteralStrings(s){for(var i=literalStrings.length;--i>=0;updateStats(s))s=s.replace(new RegExp("__"+i+"__"),literalStrings[i]);return s}function replaceSemiColons(s){s=s.replace(/;}/g,'}');updateStats(s);s=s.replace(/;;+/g,';');return updateStats(s)}function updateStats(s,a){if(!s||(!theForm.realtime.checked&&!a))return s;theForm.sizeOut.value=Math.floor(s.length/1024)+" KB";theForm.sizeDiff.value=Math.floor((theForm.codeIn.value.length-s.length)/1024)+" KB";if(theForm.codeIn.value.length>0)theForm.pctOut.value=100-Math.ceil(s.length/theForm.codeIn.value.length*10000)/100;return(!a?s:(theForm.codeOut.value=s))}